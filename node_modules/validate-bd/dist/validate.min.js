import _ from"lodash";import validators from"./validators.min.js";var deepValueSearch=function(t,i,e){var a=e,r=t.split(/\.\./g);if(2===r.length)a=[],_.each(r,(t=>{if(i){if(_.isArray(i))return _.each(i,((e,r)=>{var l=parseInt(r,10)+1,o=i.length===l;if(void 0===e)return a.push(SyntaxError);let n=deepValueSearch(t,e);(void 0!==n||o)&&a.push(n)}));i=deepValueSearch(t,i)}}));else{r=t.split(/\./g);let e=_.cloneDeep(i);_.each(r,(t=>{try{e=e[t]}catch(t){e=void 0}})),void 0!==e&&(a=e)}return a},vl={validators:validators,validator:()=>[validator,config],_validator(t=!1){return this.validator()[t?1:0]},deepValueSearch:deepValueSearch,validateAll:!0,_validate(t,i){if(!i.validate||!this.validate)return!0;t=_.extend({},t);var e=this.validationError=this.validate(t,i)||null;return!e||(this.trigger("invalid",this,e,_.extend(i,{validationError:e})),!1)},validate(t,i={}){i=_.defaults(i,{validateAll:this.validateAll});var e=[],a=this.getValidations(t,i),r=this.nonEmptyValidation(),l={};for(let o in a){l[o]=!0;let n,s=this.deepValueSearch(o,t);(!_.isArray(s)&&!_.isPlainObject(s)||!/\.\.\w+/.test(o)&&_.isArray(s))&&(s=[s]),!_.isArray(a[o])&&(a[o]=[a[o]]);for(let d in a[o]){let v=a[o][d];if(parseInt(d,10)||"string"!=typeof v){if(_.isArray(v)||(v=[v,n||this.getRequiredErrorMessage(o)]),"boolean"==typeof v[0]||void 0===v[0]){if(l[o]=!1!==v,!l[o])continue;v=[r,v[1]||n||this.getRequiredErrorMessage(o),v[2]||null]}e=e.concat(this.validateValues(s,l[o],i.validateAll,o,t,v))}else n=v}}return e.length>0?e:null},nonEmptyValidation(){return this._validator(!0).nonEmptyValidation(this._validator())},validateValues(t,i,e,a,r,l){var o=[];for(var n in t)t[n]!==SyntaxError&&(o=o.concat(this.validateValue(n,t[n],i,e,a,r,l)));return o},validateValue(t,i,e,a,r,l,o){var n=[];let s=this.getValidationValue(o,i,l,r);return this.isRequiredNow(s,e,a)&&!this.isValid(r,l,o[0],s)&&n.push([r,o[1],t]),n},getValidationValue(t,i,e,a){if(!t[2]||"function"!=typeof t[2])return i;var r=_.extend({},this.attributes,e);return t[2](i,r,a)},getValidations(t,i={}){var e=("function"==typeof this.validations?this.validations(t,i):this.validations)||{};return("function"==typeof i.validations?_.bind(i.validations,this)(t,i):i.validations)||e},getMandatoryValidations(t,i={}){var e=this.getValidations(t,i),a={};for(let t in e){!_.isArray(e[t])&&(e[t]=[e[t]]);for(let i in e[t]){let r=e[t][i];(void 0===r[0]||"boolean"==typeof r[0]&&!1!==r[0]||"object"==typeof r[0]&&!r[0].test(""))&&(!(t in a)&&(a[t]=[]),a[t].push(r))}}return a},isRequiredNow:(t,i=!1,e)=>void 0!==t||!!i&&!!e,isValid(t,i,e,a){return this._validator(!0).isValid(e,a,t,i)},requiredErrorMessage:"Field *{{field}}* cannot be empty",getRequiredErrorMessage(t){return _.template(this.requiredErrorMessage)({field:t})},validatorDetection(t){return this._validator(!0).id===t}};export default vl;